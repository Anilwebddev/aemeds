import{jsxs as a,jsx as n,Fragment as O}from"@dropins/tools/preact-jsx-runtime.js";import{classes as A,Slot as L}from"@dropins/tools/lib.js";import{Card as N,Header as v,Accordion as x,AccordionSection as E,ContentGrid as $,Image as R}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{useState as _,useEffect as X}from"@dropins/tools/preact-hooks.js";import{events as Y}from"@dropins/tools/event-bus.js";import"@dropins/tools/preact.js";import{u as Z}from"../chunks/useIsMobile.js";import{Text as G,useText as P}from"@dropins/tools/i18n.js";import{C as k}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";var V=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))(V||{});const D=({orderData:e})=>{const[r,i]=_(!0),[c,h]=_(e),[f,S]=_(!1);return X(()=>{const C=Y.on("order/data",u=>{h(u),S(u==null?void 0:u.isVirtual),i(!1)},{eager:!0});return()=>{C==null||C.off()}},[]),{loading:r,order:c,isVirtualProduct:f}},ii=({slots:e,collapseThreshold:r,translations:i,returnData:c,routeTracking:h,routeProductDetails:f})=>{var g;const S=Z(),C=f?"a":"span",u=c.items.reduce((s,m)=>+(m==null?void 0:m.totalQuantity)+s,0);return a(N,{variant:"secondary",className:A(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[n(v,{title:i.returnOrderCardTitle}),a("div",{children:[(g=c==null?void 0:c.tracking)==null?void 0:g.map((s,m)=>{var T,t;return a("p",{children:[`${i.carrier} ${(t=(T=s==null?void 0:s.carrier)==null?void 0:T.label)==null?void 0:t.toLocaleUpperCase()}: `,n("a",{href:`${(h==null?void 0:h(s))??"#"}`,rel:"noreferrer",children:s.trackingNumber})]},`${s.trackingNumber}_${m}`)}),e!=null&&e.ReturnItemsDetails?n(L,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:c.items}}):null,n(x,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(E,{defaultOpen:r>=c.items.length,title:n(G,{id:"Order.ShippingStatusCard.itemText",plural:u,fields:{count:u}}),children:n($,{maxColumns:S?3:9,emptyGridContent:n(O,{}),className:A(["order-shipping-status-card__images",["order-shipping-status-card__images-3",S]]),children:c.items.map((s,m)=>{var o,b;const T=(o=s.thumbnail)==null?void 0:o.label,t=(b=s.thumbnail)==null?void 0:b.url;return n(C,{href:(f==null?void 0:f(s))??"#","data-testid":`${m}${s.uid}`,children:n(R,{alt:T,src:t,width:85,height:114})},`${m}${s.uid}`)})})})})]})]})},ni=({translations:e,slots:r,orderData:i,collapseThreshold:c=10,routeProductDetails:h,routeTracking:f})=>{var o,b,w,M,Q,U;const S=!!(i!=null&&i.returnNumber),C=i==null?void 0:i.returnNumber,u=h?"a":"span",g=(o=i==null?void 0:i.status)==null?void 0:o.toLocaleLowerCase(),m=((b=i==null?void 0:i.shipments)==null?void 0:b.length)===1&&(g==null?void 0:g.includes(V.COMPLETE)),T=(w=i==null?void 0:i.shipments)==null?void 0:w.every(l=>l.tracking.length===0),t=(M=i==null?void 0:i.items)==null?void 0:M.filter(l=>(l==null?void 0:l.quantityShipped)===0);if(S&&(i!=null&&i.returns.length)){const l=i.returns.find(d=>d.returnNumber===C);return!l||l.tracking.length===0?null:n(ii,{slots:r,collapseThreshold:c,translations:e,returnData:l,routeTracking:f,routeProductDetails:h})}return!i||g!=null&&g.includes(V.CANCELED)?null:(Q=i==null?void 0:i.shipments)!=null&&Q.length?T&&!(t!=null&&t.length)&&m?null:a(O,{children:[(U=i==null?void 0:i.shipments)==null?void 0:U.map(({tracking:l,items:d,id:y},J)=>{const H=d.reduce((p,I)=>+(I==null?void 0:I.orderItem.totalQuantity)+p,0);return a(N,{variant:"secondary",className:"order-shipping-status-card",children:[n(v,{title:e.shippingCardTitle}),l==null?void 0:l.map(p=>{var I;return a("div",{className:"order-shipping-status-card__header",role:"status",children:[a("div",{className:"order-shipping-status-card__header--content",children:[a("p",{children:[e.carrier," ",(I=p==null?void 0:p.carrier)==null?void 0:I.toLocaleUpperCase()," | ",p==null?void 0:p.number]}),n("p",{children:p==null?void 0:p.title})]}),r!=null&&r.DeliveryTrackActions?n(L,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:r==null?void 0:r.DeliveryTrackActions,context:{trackInformation:p}}):null]},p.number)}),m?null:n(x,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(E,{"data-position":J+1,defaultOpen:c>=(d==null?void 0:d.length),title:n(O,{children:n(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:H,fields:{count:H}})}),children:n($,{maxColumns:6,emptyGridContent:n(O,{}),className:"order-shipping-status-card__images",children:d==null?void 0:d.map(p=>{var j,F,q,W,z,B;const I=(q=(F=(j=p==null?void 0:p.orderItem)==null?void 0:j.product)==null?void 0:F.thumbnail)==null?void 0:q.label,K=(B=(z=(W=p==null?void 0:p.orderItem)==null?void 0:W.product)==null?void 0:z.thumbnail)==null?void 0:B.url;return n(u,{href:(h==null?void 0:h(p))??"#",children:n(R,{alt:I,src:K||"",width:85,height:114})},p.id)})})})}),r!=null&&r.DeliveryTimeLine?n(L,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:r==null?void 0:r.DeliveryTimeLine,context:{}}):null]},y)}),t!=null&&t.length?a(N,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[n(v,{title:e.notYetShippedTitle}),n(x,{actionIconPosition:"right",children:n(E,{defaultOpen:c>=(t==null?void 0:t.length),title:n(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:t.reduce((l,d)=>(l.totalQuantity??0)+ +d,0),fields:{count:t.reduce((l,d)=>(l.totalQuantity??0)+d,0)}}),children:n($,{maxColumns:6,emptyGridContent:n(O,{}),className:"order-shipping-status-card__images",children:t==null?void 0:t.map(l=>{var d,y;return n(u,{href:(h==null?void 0:h(l))??"#",children:n(R,{alt:(d=l.thumbnail)==null?void 0:d.label,src:((y=l.thumbnail)==null?void 0:y.url)||"",width:85,height:114})},l.id)})})})})]}):null]}):a(N,{variant:"secondary",className:"order-shipping-status-card",children:[n(v,{title:e.shippingInfoTitle}),n("div",{className:"order-shipping-status-card__header",children:a("div",{className:"order-shipping-status-card__header--content",children:[i!=null&&i.carrier?n("p",{children:i==null?void 0:i.carrier}):null,n("p",{children:e.noInfoTitle})]})})]})},mi=({slots:e,className:r,collapseThreshold:i,orderData:c,routeOrderDetails:h,routeTracking:f,routeProductDetails:S})=>{const{loading:C,order:u,isVirtualProduct:g}=D({orderData:c}),s=P({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return!C&&g?null:n("div",{className:A(["order-shipping-status",r]),children:!C&&u?n(ni,{translations:s,routeOrderDetails:h,routeTracking:f,slots:e,orderData:u,collapseThreshold:i,routeProductDetails:S}):n(k,{withCard:!1})})};export{mi as ShippingStatus,mi as default};
