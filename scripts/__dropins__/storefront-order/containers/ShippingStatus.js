import{jsxs as u,jsx as n,Fragment as b}from"@dropins/tools/preact-jsx-runtime.js";import{classes as L,Slot as A}from"@dropins/tools/lib.js";import{Card as y,Header as N,Accordion as x,AccordionSection as E,ContentGrid as $,Image as R}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{useState as _,useEffect as Q}from"@dropins/tools/preact-hooks.js";import{events as X}from"@dropins/tools/event-bus.js";import"@dropins/tools/preact.js";import{u as Z}from"../chunks/useIsMobile.js";import{Text as G,useText as Y}from"@dropins/tools/i18n.js";import{C as P}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";var o=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))(o||{});const k=({orderData:e})=>{const[s,i]=_(!0),[g,d]=_(e),[m,C]=_(!1);return Q(()=>{const f=X.on("order/data",t=>{d(t),C(t==null?void 0:t.isVirtual),i(!1)},{eager:!0});return()=>{f==null||f.off()}},[]),{loading:s,order:g,isVirtualProduct:m}},D=({slots:e,collapseThreshold:s,translations:i,returnData:g,routeTracking:d,routeProductDetails:m})=>{var t;const C=Z(),f=m?"a":"span";return u(y,{variant:"secondary",className:L(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[n(N,{title:i.returnOrderCardTitle}),u("div",{children:[(t=g==null?void 0:g.tracking)==null?void 0:t.map((l,a)=>{var S,I;return u("p",{children:[`${i.carrier} ${(I=(S=l==null?void 0:l.carrier)==null?void 0:S.label)==null?void 0:I.toLocaleUpperCase()}: `,n("a",{href:`${(d==null?void 0:d(l))??"#"}`,rel:"noreferrer",children:l.trackingNumber})]},`${l.trackingNumber}_${a}`)}),e!=null&&e.ReturnItemsDetails?n(A,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:g.items}}):null,n(x,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(E,{defaultOpen:s>=g.items.length,title:n(G,{id:"Order.ShippingStatusCard.itemText",plural:g.items.length,fields:{count:g.items.length}}),children:n($,{maxColumns:C?3:9,emptyGridContent:n(b,{}),className:L(["order-shipping-status-card__images",["order-shipping-status-card__images-3",C]]),children:g.items.map((l,a)=>{var p,T;const S=(p=l.thumbnail)==null?void 0:p.label,I=(T=l.thumbnail)==null?void 0:T.url;return n(f,{href:(m==null?void 0:m(l))??"#","data-testid":`${a}${l.uid}`,children:n(R,{alt:S,src:I,width:85,height:114})},`${a}${l.uid}`)})})})})]})]})},ii=({translations:e,slots:s,orderData:i,collapseThreshold:g=10,routeProductDetails:d,routeTracking:m})=>{var T,w,M,V,U,H;const C=!!(i!=null&&i.returnNumber),f=i==null?void 0:i.returnNumber,t=d?"a":"span",l=(T=i==null?void 0:i.status)==null?void 0:T.toLocaleLowerCase(),S=((w=i==null?void 0:i.shipments)==null?void 0:w.length)===1&&(l==null?void 0:l.includes(o.COMPLETE)),I=(M=i==null?void 0:i.shipments)==null?void 0:M.every(r=>r.tracking.length===0),p=(V=i==null?void 0:i.items)==null?void 0:V.filter(r=>(r==null?void 0:r.quantityShipped)===0);if(C&&(i!=null&&i.returns.length)){const r=i.returns.find(c=>c.returnNumber===f);return!r||r.tracking.length===0?null:n(D,{slots:s,collapseThreshold:g,translations:e,returnData:r,routeTracking:m,routeProductDetails:d})}return!i||l!=null&&l.includes(o.CANCELED)?null:(U=i==null?void 0:i.shipments)!=null&&U.length?I&&!(p!=null&&p.length)&&S?null:u(b,{children:[(H=i==null?void 0:i.shipments)==null?void 0:H.map(({tracking:r,items:c,id:O},J)=>u(y,{variant:"secondary",className:"order-shipping-status-card",children:[n(N,{title:e.shippingCardTitle}),r==null?void 0:r.map(h=>{var v;return u("div",{className:"order-shipping-status-card__header",role:"status",children:[u("div",{className:"order-shipping-status-card__header--content",children:[u("p",{children:[e.carrier," ",(v=h==null?void 0:h.carrier)==null?void 0:v.toLocaleUpperCase()," | ",h==null?void 0:h.number]}),n("p",{children:h==null?void 0:h.title})]}),s!=null&&s.DeliveryTrackActions?n(A,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:s==null?void 0:s.DeliveryTrackActions,context:{trackInformation:h}}):null]},h.number)}),S?null:n(x,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(E,{"data-position":J+1,defaultOpen:g>=(c==null?void 0:c.length),title:n(b,{children:n(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:c==null?void 0:c.length,fields:{count:c==null?void 0:c.length}})}),children:n($,{maxColumns:6,emptyGridContent:n(b,{}),className:"order-shipping-status-card__images",children:c==null?void 0:c.map(h=>{var j,F,q,W,z,B;const v=(q=(F=(j=h==null?void 0:h.orderItem)==null?void 0:j.product)==null?void 0:F.thumbnail)==null?void 0:q.label,K=(B=(z=(W=h==null?void 0:h.orderItem)==null?void 0:W.product)==null?void 0:z.thumbnail)==null?void 0:B.url;return n(t,{href:(d==null?void 0:d(h))??"#",children:n(R,{alt:v,src:K||"",width:85,height:114})},h.id)})})})}),s!=null&&s.DeliveryTimeLine?n(A,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:s==null?void 0:s.DeliveryTimeLine,context:{}}):null]},O)),p!=null&&p.length?u(y,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[n(N,{title:e.notYetShippedTitle}),n(x,{actionIconPosition:"right",children:n(E,{defaultOpen:g>=(p==null?void 0:p.length),title:n(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:p==null?void 0:p.length,fields:{count:p==null?void 0:p.length}}),children:n($,{maxColumns:6,emptyGridContent:n(b,{}),className:"order-shipping-status-card__images",children:p==null?void 0:p.map(r=>{var c,O;return n(t,{href:(d==null?void 0:d(r))??"#",children:n(R,{alt:(c=r.thumbnail)==null?void 0:c.label,src:((O=r.thumbnail)==null?void 0:O.url)||"",width:85,height:114})},r.id)})})})})]}):null]}):u(y,{variant:"secondary",className:"order-shipping-status-card",children:[n(N,{title:e.shippingInfoTitle}),n("div",{className:"order-shipping-status-card__header",children:u("div",{className:"order-shipping-status-card__header--content",children:[i!=null&&i.carrier?n("p",{children:i==null?void 0:i.carrier}):null,n("p",{children:e.noInfoTitle})]})})]})},ui=({slots:e,className:s,collapseThreshold:i,orderData:g,routeOrderDetails:d,routeTracking:m,routeProductDetails:C})=>{const{loading:f,order:t,isVirtualProduct:l}=k({orderData:g}),a=Y({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return!f&&l?null:n("div",{className:L(["order-shipping-status",s]),children:!f&&t?n(ii,{translations:a,routeOrderDetails:d,routeTracking:m,slots:e,orderData:t,collapseThreshold:i,routeProductDetails:C}):n(P,{withCard:!1})})};export{ui as ShippingStatus,ui as default};
