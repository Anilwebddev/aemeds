import{jsxs as f,jsx as n,Fragment as O}from"@dropins/tools/preact-jsx-runtime.js";import{classes as A,Slot as o}from"@dropins/tools/lib.js";import{Card as N,Header as _,Accordion as x,AccordionSection as E,ContentGrid as $,Image as R}from"@dropins/tools/components.js";import"../chunks/OrderCancel.js";import{useState as L,useEffect as K}from"@dropins/tools/preact-hooks.js";import{events as X}from"@dropins/tools/event-bus.js";import"@dropins/tools/preact.js";import{u as Z}from"../chunks/useIsMobile.js";import{Text as G,useText as Y}from"@dropins/tools/i18n.js";import{C as P}from"../chunks/OrderLoaders.js";import"@dropins/tools/preact-compat.js";var w=(e=>(e.PENDING="pending",e.SHIPPING="shipping",e.COMPLETE="complete",e.PROCESSING="processing",e.HOLD="on hold",e.CANCELED="Canceled",e.SUSPECTED_FRAUD="suspected fraud",e.PAYMENT_REVIEW="payment review",e))(w||{});const k=({orderData:e})=>{const[h,i]=L(!0),[d,t]=L(e),[C,S]=L(!1);return K(()=>{const a=X.on("order/data",g=>{t(g),S(g==null?void 0:g.isVirtual),i(!1)},{eager:!0});return()=>{a==null||a.off()}},[]),{loading:h,order:d,isVirtualProduct:C}},D=({slots:e,collapseThreshold:h,translations:i,returnData:d,routeTracking:t,routeProductDetails:C})=>{var u;const S=Z(),a=C?"a":"span",g=d.items.reduce((s,m)=>+(m==null?void 0:m.totalQuantity)+s,0);return f(N,{variant:"secondary",className:A(["order-shipping-status-card","order-shipping-status-card--return-order"]),children:[n(_,{title:i.returnOrderCardTitle}),f("div",{children:[(u=d==null?void 0:d.tracking)==null?void 0:u.map((s,m)=>{var I,l;return f("p",{children:[`${i.carrier} ${(l=(I=s==null?void 0:s.carrier)==null?void 0:I.label)==null?void 0:l.toLocaleUpperCase()}: `,n("a",{href:`${(t==null?void 0:t(s))??"#"}`,rel:"noreferrer",children:s.trackingNumber})]},`${s.trackingNumber}_${m}`)}),e!=null&&e.ReturnItemsDetails?n(o,{"data-testid":"returnItemsDetails",name:"ReturnItemsDetails",slot:e==null?void 0:e.ReturnItemsDetails,context:{items:d.items}}):null,n(x,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(E,{defaultOpen:h>=d.items.length,title:n(G,{id:"Order.ShippingStatusCard.itemText",plural:g,fields:{count:g}}),children:n($,{maxColumns:S?3:9,emptyGridContent:n(O,{}),className:A(["order-shipping-status-card__images",["order-shipping-status-card__images-3",S]]),children:d.items.map((s,m)=>{var T,b;const I=(T=s.thumbnail)==null?void 0:T.label,l=(b=s.thumbnail)==null?void 0:b.url;return n(a,{href:(C==null?void 0:C(s))??"#","data-testid":`${m}${s.uid}`,children:n(R,{alt:I,src:l,width:85,height:114})},`${m}${s.uid}`)})})})})]})]})},ii=({translations:e,slots:h,orderData:i,collapseThreshold:d=10,routeProductDetails:t,routeTracking:C})=>{var T,b,V,M,U,H;const S=!!(i!=null&&i.returnNumber),a=i==null?void 0:i.returnNumber,g=t?"a":"span",u=(T=i==null?void 0:i.status)==null?void 0:T.toLocaleLowerCase(),m=((b=i==null?void 0:i.shipments)==null?void 0:b.length)===1&&(u==null?void 0:u.includes(w.COMPLETE)),I=(V=i==null?void 0:i.shipments)==null?void 0:V.every(r=>r.tracking.length===0),l=(M=i==null?void 0:i.items)==null?void 0:M.filter(r=>(r==null?void 0:r.quantityShipped)===0);if(S&&(i!=null&&i.returns.length)){const r=i.returns.find(c=>c.returnNumber===a);return!r||r.tracking.length===0?null:n(D,{slots:h,collapseThreshold:d,translations:e,returnData:r,routeTracking:C,routeProductDetails:t})}return!i||u!=null&&u.includes(w.CANCELED)?null:(U=i==null?void 0:i.shipments)!=null&&U.length?I&&!(l!=null&&l.length)&&m?null:f(O,{children:[(H=i==null?void 0:i.shipments)==null?void 0:H.map(({tracking:r,items:c,id:v},B)=>f(N,{variant:"secondary",className:"order-shipping-status-card",children:[n(_,{title:e.shippingCardTitle}),r==null?void 0:r.map(p=>{var y;return f("div",{className:"order-shipping-status-card__header",role:"status",children:[f("div",{className:"order-shipping-status-card__header--content",children:[f("p",{children:[e.carrier," ",(y=p==null?void 0:p.carrier)==null?void 0:y.toLocaleUpperCase()," | ",p==null?void 0:p.number]}),n("p",{children:p==null?void 0:p.title})]}),h!=null&&h.DeliveryTrackActions?n(o,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:h==null?void 0:h.DeliveryTrackActions,context:{trackInformation:p}}):null]},p.number)}),m?null:n(x,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n(E,{"data-position":B+1,defaultOpen:d>=(c==null?void 0:c.length),title:n(O,{children:n(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:c==null?void 0:c.length,fields:{count:c==null?void 0:c.length}})}),children:n($,{maxColumns:6,emptyGridContent:n(O,{}),className:"order-shipping-status-card__images",children:c==null?void 0:c.map(p=>{var j,F,q,Q,W,z;const y=(q=(F=(j=p==null?void 0:p.orderItem)==null?void 0:j.product)==null?void 0:F.thumbnail)==null?void 0:q.label,J=(z=(W=(Q=p==null?void 0:p.orderItem)==null?void 0:Q.product)==null?void 0:W.thumbnail)==null?void 0:z.url;return n(g,{href:(t==null?void 0:t(p))??"#",children:n(R,{alt:y,src:J||"",width:85,height:114})},p.id)})})})}),h!=null&&h.DeliveryTimeLine?n(o,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:h==null?void 0:h.DeliveryTimeLine,context:{}}):null]},v)),l!=null&&l.length?f(N,{variant:"secondary",className:"order-shipping-status-card","data-testid":"dropinAccordionNotYetShipped2",children:[n(_,{title:e.notYetShippedTitle}),n(x,{actionIconPosition:"right",children:n(E,{defaultOpen:d>=(l==null?void 0:l.length),title:n(G,{id:"Order.ShippingStatusCard.notYetShippedImagesTitle",plural:l==null?void 0:l.length,fields:{count:l==null?void 0:l.length}}),children:n($,{maxColumns:6,emptyGridContent:n(O,{}),className:"order-shipping-status-card__images",children:l==null?void 0:l.map(r=>{var c,v;return n(g,{href:(t==null?void 0:t(r))??"#",children:n(R,{alt:(c=r.thumbnail)==null?void 0:c.label,src:((v=r.thumbnail)==null?void 0:v.url)||"",width:85,height:114})},r.id)})})})})]}):null]}):f(N,{variant:"secondary",className:"order-shipping-status-card",children:[n(_,{title:e.shippingInfoTitle}),n("div",{className:"order-shipping-status-card__header",children:f("div",{className:"order-shipping-status-card__header--content",children:[i!=null&&i.carrier?n("p",{children:i==null?void 0:i.carrier}):null,n("p",{children:e.noInfoTitle})]})})]})},ui=({slots:e,className:h,collapseThreshold:i,orderData:d,routeOrderDetails:t,routeTracking:C,routeProductDetails:S})=>{const{loading:a,order:g,isVirtualProduct:u}=k({orderData:d}),s=Y({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf",returnOrderCardTitle:"Order.ShippingStatusCard.returnOrderCardTitle",shippingCardTitle:"Order.ShippingStatusCard.shippingCardTitle",shippingInfoTitle:"Order.ShippingStatusCard.shippingInfoTitle",notYetShippedTitle:"Order.ShippingStatusCard.notYetShippedTitle",noInfoTitle:"Order.ShippingStatusCard.noInfoTitle",returnNumber:"Order.ShippingStatusCard.returnNumber",orderNumber:"Order.ShippingStatusCard.orderNumber"});return!a&&u?null:n("div",{className:A(["order-shipping-status",h]),children:!a&&g?n(ii,{translations:s,routeOrderDetails:t,routeTracking:C,slots:e,orderData:g,collapseThreshold:i,routeProductDetails:S}):n(P,{withCard:!1})})};export{ui as ShippingStatus,ui as default};
